---
date: 2014-05-06 17:00:00
layout: post
title: 了解ARP攻击与DNS设置使用手册
thread: 120
categories: Tutorial
tags: [ARP]
---

ARP的功能是显示和修改地址解析协议(ARP)使用的“IP 到物理”地址转换表。

其中有如下几种几种用法：

```
ARP -s inet_addr eth_addr [if_addr]
ARP -d inet_addr [if_addr]
ARP -a [inet_addr] [-N if_addr] [-v]
```

* `-a` 通过询问当前协议数据，显示当前 ARP 项。如果指定inet_addr，则只显示指定计算机的 IP 地址和物理地址。如果不止一个网络接口使用 ARP，则显示每个 ARP 表的项。
* `-g` 与 -a 相同。
* `-v` 在详细模式下显示当前 ARP 项。所有无效项和环回接口上的项都将显示。
* `inet_addr` 指定 Internet 地址。
* `-N if_addr` 显示 if_addr 指定的网络接口的 ARP 项。
* `-d` 删除 inet_addr 指定的主机。inet_addr 可以是通配符 *，以删除所有主机。
* `-s` 添加主机并且将 Internet 地址 inet_addr与物理地址 eth_addr 相关联。物理地址是用连字符分隔的 6 个十六进制字节。该项是永久的。
* `eth_addr` 指定物理地址。
* `if_addr` 如果存在，此项指定地址转换表应修改的接口的 Internet 地址。如果不存在，则使用第一个适用的接口。

**示例:**

>  \> arp -s 157.55.85.212   00-aa-00-62-c6-09.... 添加静态项。

>  \> arp -a                                  .... 显示 ARP 表。

----

**知识拓展**

* **什么是ARP？**

ARP协议是“Address Resolution Protocol”（地址解析协议）的缩写。在局域网中，网络中实际传输的是“帧”，帧里面是有目标主机的MAC地址的。在以太网中，一个主机要和另一个主机进行直接通信，必须要知道目标主机的MAC地址。但这个目标MAC地址是如何获得的呢？它就是通过地址解析协议获得的。所谓“地址解析”就是主机在发送帧前将目标IP地址转换成目标MAC地址的过程。ARP协议的基本功能就是通过目标设备的IP地址，查询目标设备的MAC地址，以保证通信的顺利进行。

在局域网中，通过ARP协议来完成IP地址转换为第二层物理地址（即MAC地址）的，ARP协议对网络安全具有重要的意义。

* **ARP协议的工作原理**

正常情况下，每台主机都会在自己的ARP缓冲区中建立一个 ARP列表，以表示IP地址和MAC地址的对应关系。当源主机需要将一个数据包要发送到目的主机时，会首先检查自己 ARP列表中是否存在该 IP地址对应的MAC地址，如果有﹐就直接将数据包发送到这个MAC地址；如果没有，就向本地网段发起一个ARP请求的广播包，查询此目的主机对应的MAC地址。此ARP请求数据包里包括源主机的IP地址、硬件地址、以及目的主机的IP地址。网络中所有的主机收到这个ARP请求后，会检查数据包中的目的IP是否和自己的IP地址一致。如果不相同就忽略此数据包；如果相同，该主机首先将发送端的MAC地址和IP地址添加到自己的ARP列表中，如果ARP表中已经存在该IP的信息，则将其覆盖，然后给源主机发送一个 ARP响应数据包，告诉对方自己是它需要查找的MAC地址；源主机收到这个ARP响应数据包后，将得到的目的主机的IP地址和MAC地址添加到自己的ARP列表中，并利用此信息开始数据的传输。

* **ARP欺骗的原理**

ARP类型的攻击最早用于盗取密码之用，网内中毒电脑可以伪装成路由器，盗取用户的密码， 后来发展成内藏于软件，扰乱其他局域网用户正常的网络通信，下面我们简要阐述ARP欺骗的原理：

假设这样一个网络，一个交换机连接了3台机器，依次是计算机A，B，C

>A的地址为：IP：192.168.1.1 MAC: AA-AA-AA-AA-AA-AA 

>B的地址为：IP：192.168.1.2 MAC: BB-BB-BB-BB-BB-BB 

>C的地址为：IP：192.168.1.3 MAC: CC-CC-CC-CC-CC-CC 

第二步：正常情况下在A计算机上运行ARP -A查询ARP缓存表应该出现如下信息。 

>Interface: 192.168.1.1 on Interface 0x1000003 

>Internet Address Physical Address Type 

>192.168.1.3 CC-CC-CC-CC-CC-CC dynamic 

第三步：在计算机B上运行ARP欺骗程序，来发送ARP欺骗包。

B向A发送一个自己伪造的ARP应答，而这个应答中的数据为发送方IP地址是192.168.10.3（C的IP地址），MAC地址是DD-DD-DD-DD-DD-DD（C的MAC地址本来应该是CC-CC-CC-CC-CC-CC，这里被伪造了）。当A接收到B伪造的ARP应答，就会更新本地的ARP缓存（A可不知道被伪造了）。而且A不知道其实是从B发送过来的，A这里只有192.168.10.3（C的IP地址）和无效的DD-DD-DD-DD-DD-DD MAC地址。

第四步：欺骗完毕我们在A计算机上运行ARP -A来查询ARP缓存信息。你会发现原来正确的信息现在已经出现了错误。

>Interface: 192.168.1.1 on Interface 0x1000003 

>Internet Address Physical Address Type 

>192.168.1.3 DD-DD-DD-DD-DD-DD dynamic

上面例子中在计算机A上的关于计算机C的MAC地址已经错误了，所以即使以后从A计算机访问C计算机这个192.168.1.3这个地址也会被ARP协议错误的解析成MAC地址为DD-DD-DD-DD-DD-DD的。

当局域网中一台机器，反复向其他机器，特别是向网关，发送这样无效假冒的ARP应答信息包时，严重的网络堵塞就会开始。由于网关MAC地址错误，所以从网络中计算机发来的数据无法正常发到网关，自然无法正常上网。这就造成了无法访问外网的问题，另外由于很多时候网关还控制着我们的局域网LAN上网，所以这时我们的LAN访问也就出现问题了。

----

面对这一情况，常见的解决方法就是将IP和MAC静态绑定，在网内把主机和网关都做IP和MAC绑定。 这里就需要用到上面所说的ARP命令咯。