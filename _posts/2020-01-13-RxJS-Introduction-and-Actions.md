---
title: å“åº”å¼ç¼–ç¨‹å…¥é—¨æŒ‡å— - é€šä¿—æ˜“æ‡‚ RxJS
layout: post
thread: 237
date: 2020-01-13
author: Joe Jiang
categories: Document
tags: [å“åº”å¼ç¼–ç¨‹, RxJS, Stream, æµ]
excerpt: æœ¬æ–‡ä»åˆå­¦è€…çš„è§’åº¦å‡ºå‘ï¼Œå¸Œæœ›ç”±æµ…å…¥æ·±å…¨é¢çš„æ¢³ç†ä¸€ä¸‹æœ‰å…³ RxJS çš„å„ä¸ªæ–¹é¢
header:
  image: ../assets/in-post/2020-01-13-RxJS-Introduction-and-Actions-Teaser.jpg
---

> å…¨æ–‡ç¯‡å¹…è¾ƒé•¿ï¼Œå»ºè®®é€‰å–ä¸€æ®µç‹¬ç«‹çš„æ—¶é—´æ¥é˜…è¯»æ­¤æ–‡ã€‚

RxJS æ˜¯ Reactive Extensions for JavaScript çš„ç¼©å†™ï¼Œèµ·æºäº Reactive Extensionsï¼Œæ˜¯ä¸€ä¸ªåŸºäºå¯è§‚æµ‹æ•°æ®æµ Stream ç»“åˆè§‚å¯Ÿè€…æ¨¡å¼å’Œè¿­ä»£å™¨æ¨¡å¼çš„ä¸€ç§å¼‚æ­¥ç¼–ç¨‹çš„åº”ç”¨åº“ã€‚RxJS æ˜¯ Reactive Extensions åœ¨ JavaScript ä¸Šçš„å®ç°ã€‚

æŒ‰ç…§æ­£å¸¸çš„èŠ‚å¥ï¼Œå¬åˆ° RxJS æ—¶ï¼Œæˆ‘ç¬¬ä¸€æ—¶é—´æ˜¯æ‰“å¼€å®˜æ–¹æ–‡æ¡£é˜…è¯»çš„ï¼Œä½†åœ¨æ²¡å®é™…ä¸Šæ‰‹æ“ä½œä¹‹å‰ï¼Œæ–‡æ¡£çš„è¯¸å¤šæè¿°å’Œå…³é”®è¯è®©æˆ‘è¯»çš„æœ‰äº›æ‘¸ä¸ç€å¤´è„‘ã€‚RxJs æ˜¯å¹²ä»€ä¹ˆçš„ã€å®ƒè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Œåªæœ‰æ‰¾åˆ°è¿™ä¸¤ä¸ªé—®é¢˜çš„ç­”æ¡ˆæˆ‘æ‰èƒ½å¯¹ RxJS æœ‰æ‰€ä½“æ„Ÿã€‚

ç½‘ä¸Šå­˜åœ¨å„å¼å„æ ·çš„æ•™ç¨‹æˆ–è€…è®²è§£ï¼Œä½†æ­£å¦‚å¤§éƒ¨åˆ†æ–‡ç« æ‰€è¿°ï¼Œè™½ç„¶ RxJS å¦‚æ­¤å¼ºå¤§ï¼Œä½†æ¦‚å¿µä¼—å¤šã€ä¸€åˆ‡çš†ä¸ºæµçš„æ€æƒ³åˆè´¯ç©¿å§‹ç»ˆï¼Œä¾¿å­˜åœ¨ã€Œå­¦ä¹ é—¨æ§›è¿‡é«˜ï½œçš„é”™è§‰ã€‚æœ¬æ–‡ä»åˆå­¦è€…çš„è§’åº¦å‡ºå‘ï¼Œå¸Œæœ›ç”±æµ…å…¥æ·±å…¨é¢çš„æ¢³ç†ä¸€ä¸‹æœ‰å…³ RxJS çš„å„ä¸ªæ–¹é¢ï¼Œæœ¬æ–‡ç¼–æ’é¡ºåºå¦‚ä¸‹ï¼š

1. åˆè¯† RxJS çš„åšäº‹æ–¹æ³• - å…ˆç”¨ä¸€ä¸ªå­—ç¬¦ä¸²è¾“å…¥å’Œå¤„ç†æ˜¾ç¤ºçš„ä¾‹å­ç®€å•æ¼”ç¤ºå¦‚ä½•ç”¨ RxJS å®ç°æˆ‘ä»¬çš„æ—¥å¸¸éœ€æ±‚ï¼›
2. çŸ¥è¯†ç‚¹æ‰«ç›²ä¸ææŒ¯ä¿¡å¿ƒ - ç„¶åå°†ä¸€ç³»åˆ—å­¦ä¹  RxJS ä¹‹å‰éœ€è¦äº†è§£çš„å‰ç½®çŸ¥è¯†ç‚¹æ¢³ç†ä¸€éï¼Œæ¯”å¦‚åŒæ­¥/å¼‚æ­¥ã€è§‚å¯Ÿè€…æ¨¡å¼ã€å“åº”å¼ç¼–ç¨‹ã€è¿­ä»£å™¨æ¨¡å¼ã€Stream ç­‰ç­‰ï¼Œè¿™æœ‰ç‚¹åƒå†™è®ºæ–‡ä¸­çš„ related workã€‚æ¯•ç«Ÿï¼Œä¸Šæ¥å„ç§å¬ä¸æ‡‚çš„åè¯ï¼Œå¾ˆå®¹æ˜“ä½¿åˆå­¦è€…æœ›è€Œå´æ­¥ï¼›
3. RxJS æ ¸å¿ƒæ¦‚å¿µä¸ç¤ºä¾‹ - æ¥ç€é¡ºåŠ¿å¼•å…¥ RxJS åŠå…¶ç›¸å…³æ ¸å¿ƒæ¦‚å¿µï¼Œæ¯”å¦‚ Observableã€Observerã€Subscriptionã€Schedulersã€Operator å’Œ Subject ç­‰ç­‰ï¼Œå¹¶é™„å¸¦ä¸€äº›ä¸ªäººç†è§£å’Œé€šä¿—æ˜“æ‡‚çš„ç¤ºä¾‹ï¼›
4. ä¸€äº›å…¶ä»–ç¤ºä¾‹ï¼Œæ¯”å¦‚ Hot/Cold Observableã€å•æ’­ä¸å¤šæ’­ç¤ºä¾‹ç­‰ç­‰ï¼Œå¸Œæœ›å¸®åŠ©ä½ ç†Ÿæ‚‰ RxJS çš„æ›´å¤šç”¨æ³•ï¼›

æƒ³æƒ³è¿æˆ‘éƒ½èƒ½å­¦ä¼šï¼Œä½ è¿˜æ€•ä»€ä¹ˆå‘¢ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¼€å§‹å§ã€‚

# ä¸€ã€ä¸€ä¸ªæ§åˆ¶æ•°æ®æµåŠ¨çš„ç¤ºä¾‹

æˆ‘ä»¬çœ‹ä¸€ä¸ªç®€å•ç¤ºä¾‹ã€‚å‡è®¾æˆ‘ä»¬çš„é¡µé¢ä¸­æœ‰ä¸€ä¸ªè¾“å…¥æ¡†ï¼Œæˆ‘ä»¬æƒ³å°†ç”¨æˆ·çš„è¾“å…¥æ‰“å°å‡ºæ¥ï¼Œä½†æœ‰ä¸ªæ¡ä»¶ï¼Œè‹¥æ˜¯è¾“å…¥å­—ç¬¦é•¿åº¦å°äº3æˆ‘ä»¬åˆ™å¿½ç•¥å¤„ç†ï¼Œå³æ§åˆ¶å°è¾“å‡ºçš„ç¬¬ä¸€ä¸ªå€¼åº”ä¸º "hel" å­—ç¬¦ä¸²ã€‚ç°åœ¨æˆ‘ä»¬è¦ç”¨ RxJs æ¥å®ç°ï¼Œè¯¥æ€ä¹ˆåšå‘¢ï¼Ÿ

    // è¾“å…¥ "hello world"
    var input = Rx.Observable.fromEvent(document.querySelector('input'), 'input');
    
    // è¿‡æ»¤æ‰å°äº3ä¸ªå­—ç¬¦é•¿åº¦çš„ç›®æ ‡å€¼
    input.filter(event => event.target.value.length > 2)
      .map(event => event.target.value)
      .subscribe(value => console.log(value)); // è®¢é˜…è¾“å‡ºå€¼

æˆ‘ä»¬å…ˆä¸ç»†æ¢ Rx.Observable çš„åˆ›å»ºæ–¹å¼ä»¥åŠé“¾å¼è°ƒç”¨å£°æ˜æ§åˆ¶å°è¾“å‡ºçš„å†™æ³•ï¼Œç®€è€Œè¨€ä¹‹ä»¥ä¸Šä¾¿æ˜¯ RxJS å¯ä»¥åšçš„ä¸€ä»¶äº‹æƒ…ï¼ŒæŠŠ DOM ä¸­çš„ç”¨æˆ·è¾“å…¥é€šè¿‡äº‹ä»¶è½¬åŒ–ä¸ºç»è¿‡é€»è¾‘å¤„ç†çš„æ§åˆ¶å°è¾“å‡ºç»“æœã€‚

æ–‡æ¡£å¯¹ RxJS çš„ä»‹ç»åªæœ‰ä¸€å¥è¯ï¼Œ**å®ƒæ˜¯ä½¿ç”¨ Observables çš„å“åº”å¼ç¼–ç¨‹çš„åº“ï¼Œå®ƒä½¿ç¼–å†™å¼‚æ­¥æˆ–åŸºäºå›è°ƒçš„ä»£ç æ›´å®¹æ˜“ã€‚**ä½†ä»ä»¥ä¸Šä¾‹å­çœ‹ï¼Œè²Œä¼¼ RxJS å¯¹å›è°ƒçš„å¤„ç†æ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«ï¼Œä½ å¯èƒ½åœ¨æƒ³ï¼Œä¸çŸ¥é“ RxJs ä¹‹å‰ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥å†™ä¸€ä¸ªä¼ ç»Ÿçš„äº‹ä»¶ç›‘å¬å™¨ï¼Œå¹¶å¡«å…¥å¤„ç†é€»è¾‘ã€‚é‚£ä¹ˆå®ƒåˆ°åº•å¼ºåœ¨å“ªï¼Œä¸ºä»€ä¹ˆä½¿å“åº”å¼ç¼–ç¨‹æ›´å®¹æ˜“äº†å‘¢ï¼Ÿè§£ç­”è¿™ä¸ªé—®é¢˜ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæŠŠå‰ç½®éœ€è¦äº†è§£çš„æ¦‚å¿µæ¢³ç†ä¸€ä¸‹ã€‚

# äºŒã€å‰ç½®çŸ¥è¯†ç‚¹

### 2.1 åŒæ­¥ä¸å¼‚æ­¥

æˆ‘ä»¬å…ˆçœ‹åˆ†å¸ƒå¼ç½‘ç»œç³»ç»Ÿä¸­çš„åŒæ­¥/å¼‚æ­¥ã€‚åˆ†å¸ƒå¼ç½‘ç»œç³»ç»Ÿä¸­ï¼Œå„ä¸ªå‚ä¸æ–¹èŠ‚ç‚¹çš„è¿è¡Œæ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œæ²¡æœ‰å…±äº«å†…å­˜ï¼Œæ²¡æœ‰å…¨å±€æ—¶é’Ÿã€‚å„èŠ‚ç‚¹é€šè¿‡æ¶ˆæ¯æ¥è¿›è¡Œæ²Ÿé€šã€‚åœ¨ä¼ ç»Ÿçš„ç†å¿µä¸­ï¼Œæˆ‘ä»¬ä¼šæŠŠè¿™æ ·çš„ç½‘ç»œæ ¹æ®ä»–ä»¬é€šä¿¡æ–¹å¼æè¿°æˆåŒæ­¥å’Œå¼‚æ­¥çš„ã€‚

- åŒæ­¥ï¼ˆSynchronousï¼‰å°±æ˜¯æ•´ä¸ªå¤„ç†è¿‡ç¨‹é¡ºåºæ‰§è¡Œï¼Œå½“å„ä¸ªè¿‡ç¨‹éƒ½æ‰§è¡Œå®Œæ¯•ï¼Œå¹¶è¿”å›ç»“æœã€‚æ˜¯ä¸€ç§çº¿æ€§æ‰§è¡Œçš„æ–¹å¼ï¼Œæ‰§è¡Œçš„æµç¨‹ä¸èƒ½è·¨è¶Šã€‚ä¸€èˆ¬ç”¨äºæµç¨‹æ€§æ¯”è¾ƒå¼ºçš„ç¨‹åºï¼Œæ¯”å¦‚ç”¨æˆ·ç™»å½•ï¼Œéœ€è¦å¯¹ç”¨æˆ·éªŒè¯å®Œæˆåæ‰èƒ½ç™»å½•ç³»ç»Ÿã€‚
- å¼‚æ­¥ï¼ˆAsynchronousï¼‰åˆ™æ˜¯åªæ˜¯å‘é€äº†è°ƒç”¨çš„æŒ‡ä»¤ï¼Œè°ƒç”¨è€…æ— éœ€ç­‰å¾…è¢«è°ƒç”¨çš„æ–¹æ³•å®Œå…¨æ‰§è¡Œå®Œæ¯•ï¼›è€Œæ˜¯ç»§ç»­æ‰§è¡Œä¸‹é¢çš„æµç¨‹ã€‚æ˜¯ä¸€ç§å¹¶è¡Œå¤„ç†çš„æ–¹å¼ï¼Œä¸å¿…ç­‰å¾…ä¸€ä¸ªç¨‹åºæ‰§è¡Œå®Œï¼Œå¯ä»¥æ‰§è¡Œå…¶å®ƒçš„ä»»åŠ¡ï¼Œæ¯”å¦‚é¡µé¢æ•°æ®åŠ è½½è¿‡ç¨‹ï¼Œä¸éœ€è¦ç­‰æ‰€æœ‰æ•°æ®è·å–åå†æ˜¾ç¤ºé¡µé¢ã€‚

è€Œä»‹ç»å¦‚ä¸Šæ¦‚å¿µä¹‹å‰ï¼Œä½œä¸ºå‰ç«¯å·¥ç¨‹å¸ˆï¼Œæœ€è¢«å¤§å®¶ç†ŸçŸ¥çš„â€œåŒæ­¥/å¼‚æ­¥â€æ¦‚å¿µå¤§æ¦‚å¦‚å›¾æ‰€ç¤º

![](/assets/in-post/2020-01-13-Introduction-of-JavaScript-Sync-Async-Example.png )

è€ŒåŒæ­¥/å¼‚æ­¥ç¼–ç¨‹å’ŒåŒæ­¥/å¼‚æ­¥ç½‘ç»œåˆæœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿä¼ ç»Ÿçš„åŒæ­¥ç¼–ç¨‹æ˜¯ä¸€ç§è¯·æ±‚å“åº”æ¨¡å‹ï¼Œè°ƒç”¨ä¸€ä¸ªæ–¹æ³•ï¼Œç­‰å¾…å…¶å“åº”è¿”å›.ã€‚è€Œå¼‚æ­¥ç¼–ç¨‹å°±æ˜¯ï¼Œå‘å‡ºä¸€ä¸ªä»»åŠ¡ï¼Œä¸ç­‰å¾…ç»“æœï¼Œå°±ç»§ç»­å‘å‡ºä¸‹ä¸€ä¸ªä»»åŠ¡ã€‚è‡³äºä¸Šä¸€ä¸ªä»»åŠ¡çš„æ‰§è¡Œç»“æœï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼è·å¾—ï¼Œä¸€ä¸ªæ˜¯ä¸»åŠ¨è½®è¯¢ï¼Œå¦ä¸€ä¸ªæ˜¯å•ç‹¬å¼€ä¸€ä¸ªçº¿ç¨‹å»ç­‰å¾…ç»“æœæ¥æ”¶å¹¶å›è°ƒæ‰§è¡Œã€‚

### 2.2 å“åº”å¼ç¼–ç¨‹

å“åº”å¼ç¼–ç¨‹ï¼Œå³ Reactive Programmingã€‚å®ƒæ˜¯ä¸€ç§åŸºäºäº‹ä»¶æ¨¡å¼çš„æ¨¡å‹ã€‚åœ¨ä¸Šé¢çš„å¼‚æ­¥ç¼–ç¨‹æ¨¡å¼ä¸­ï¼Œæˆ‘ä»¬æè¿°äº†ä¸¤ç§è·å¾—ä¸Šä¸€ä¸ªä»»åŠ¡æ‰§è¡Œç»“æœçš„æ–¹å¼ï¼Œä¸€ä¸ªå°±æ˜¯ä¸»åŠ¨è½®è¯¢ï¼Œæˆ‘ä»¬æŠŠå®ƒç§°ä¸º Proactive æ–¹å¼ï¼›å¦ä¸€ä¸ªå°±æ˜¯è¢«åŠ¨æ¥æ”¶åé¦ˆï¼Œæˆ‘ä»¬ç§°ä¸º Reactive æ–¹å¼ã€‚ç®€å•æ¥è¯´ï¼Œåœ¨ Reactive æ–¹å¼ä¸­ï¼Œä¸Šä¸€ä¸ªä»»åŠ¡æ‰§è¡Œç»“æœçš„åé¦ˆå°±æ˜¯ä¸€ä¸ªäº‹ä»¶ï¼Œè¿™ä¸ªäº‹ä»¶çš„åˆ°æ¥ä¼šè§¦å‘ä¸‹ä¸€ä¸ªä»»åŠ¡çš„æ‰§è¡Œã€‚

ç½‘ä¸Šæœ‰ä¸€å¤§å †å®šä¹‰ï¼Œç†è®ºåŒ–æˆ–è€…æ³›æ³›è€Œè°ˆï¼Œå¯¹äºåˆå­¦è€…æ¥è¯´ä¸€å¥è¯æ¦‚æ‹¬ï¼Œ**å“åº”å¼ç¼–ç¨‹æ˜¯ä½¿ç”¨å¼‚æ­¥æ•°æ®æµè¿›è¡Œç¼–ç¨‹ã€‚**

> å“åº”å¼ç¼–ç¨‹çš„æ€è·¯å¤§æ¦‚å¦‚ä¸‹ï¼šä½ å¯ä»¥ç”¨åŒ…æ‹¬ Click å’Œ Hover äº‹ä»¶åœ¨å†…çš„ä»»ä½•ä¸œè¥¿åˆ›å»º Data streamï¼ˆä¹Ÿç§°â€œæµâ€ï¼Œåç»­ç« èŠ‚è¯¦è¿°ï¼‰ã€‚Stream å»‰ä»·ä¸”å¸¸è§ï¼Œä»»ä½•ä¸œè¥¿éƒ½å¯ä»¥æ˜¯ä¸€ä¸ª Streamï¼šå˜é‡ã€ç”¨æˆ·è¾“å…¥ã€å±æ€§ã€Cacheã€æ•°æ®ç»“æ„ç­‰ç­‰ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œæƒ³åƒä¸€ä¸‹ä½ çš„ Twitter feed å°±åƒæ˜¯ Click events é‚£æ ·çš„ Data streamï¼Œä½ å¯ä»¥ç›‘å¬å®ƒå¹¶ç›¸åº”çš„ä½œå‡ºå“åº”ã€‚

> åœ¨è¿™ä¸ªåŸºç¡€ä¸Šï¼Œä½ è¿˜æœ‰ä»¤äººæƒŠè‰³çš„å‡½æ•°å»ç»„åˆã€åˆ›å»ºã€è¿‡æ»¤è¿™äº› Streamsï¼Œè¿™å°±æ˜¯å‡½æ•°å¼é­”æ³•çš„ç”¨æ­¦ä¹‹åœ°ã€‚Stream èƒ½æ¥å—ä¸€ä¸ªï¼Œç”šè‡³å¤šä¸ª Stream ä¸ºè¾“å…¥ï¼Œä½ å¯ä»¥èåˆä¸¤ä¸ª Streamï¼Œä¹Ÿå¯ä»¥ä»ä¸€ä¸ª Stream ä¸­è¿‡æ»¤å‡ºä½ æ„Ÿå…´è¶£çš„ Events ä»¥ç”Ÿæˆä¸€ä¸ªæ–°çš„ Streamï¼Œè¿˜å¯ä»¥æŠŠä¸€ä¸ª Stream ä¸­çš„æ•°æ®æ˜ å°„åˆ°ä¸€ä¸ªæ–°çš„ Stream ä¸­ã€‚â€”â€”æ‘˜è‡ª[ã€Šå“åº”å¼ç¼–ç¨‹ä»‹ç»ã€‹](https://zhuanlan.zhihu.com/p/27678951)

### 2.3 Stream / æµ

ä½œä¸ºå“åº”å¼ç¼–ç¨‹çš„æ ¸å¿ƒï¼Œæµçš„æœ¬è´¨æ˜¯ä¸€ä¸ªæŒ‰æ—¶é—´é¡ºåºæ’åˆ—çš„è¿›è¡Œä¸­äº‹ä»¶çš„åºåˆ—é›†åˆã€‚å®ƒå¯ä»¥å‘é€ä¸‰ç§ä¸åŒçš„äº‹ç‰©ï¼š

- æŸç§ç±»å‹çš„å€¼
- é”™è¯¯ï¼ˆErrorï¼‰
- å·²å®Œæˆä¿¡å·ï¼ˆ"Completed" Signalï¼‰

ä¸‹å›¾æ˜¯ç‚¹å‡»æŒ‰é’®çš„ä¸€ä¸ªäº‹ä»¶æµç¤ºæ„å›¾

![](/assets/in-post/2020-01-13-Introduction-of-RxJS-Stream-Example.png )

è¯¥ç¤ºæ„å›¾ä½¿ç”¨ ASCII é‡ç”»é•¿æˆè¿™æ ·ï¼š

    --a---b-c---d---X---|->
    
    a, b, c, d are emitted values
    X is an error
    | is the 'completed' signal
    ---> is the timeline

æˆ‘ä»¬å¯ä»¥é’ˆå¯¹å®ƒåšä¸€äº›å¤„ç†ï¼Œå°†å®ƒè½¬åŒ–ä¸ºä¸€ä¸ªæ–°çš„ streamï¼Œæ¯”å¦‚åšä¸€ä¸ªèƒ½è®°å½•ä¸€ä¸ªæŒ‰é’®ç‚¹å‡»äº†å¤šå°‘æ¬¡çš„è®¡æ•°å™¨ Streamã€‚åœ¨å¸¸è§çš„å“åº”å¼ç¼–ç¨‹åº“ä¸­ï¼Œæ¯ä¸ª stream éƒ½ä¼šæœ‰å¤šä¸ªæ–¹æ³•ï¼Œmapã€filterã€scan ç­‰ç­‰ã€‚å½“ä½ è°ƒç”¨å…¶ä¸­ä¸€ä¸ªæ–¹æ³•æ—¶ï¼Œä¾‹å¦‚ `clickStream.map(f)`ï¼Œå®ƒå°±ä¼šåŸºäºåŸæ¥çš„ click stream è¿”å›ä¸€ä¸ªæ–°çš„ `stream`ã€‚å®ƒä¸ä¼šå¯¹åŸæ¥çš„ `click steam` ä½œä»»ä½•ä¿®æ”¹ã€‚è¿™ä¸ªç‰¹æ€§å°±æ˜¯ä¸å¯å˜æ€§(Immutability)ï¼Œå®ƒä¹‹äºå“åº”å¼ç¼–ç¨‹ Streamï¼Œå°±å¦‚ç³–æµ†ä¹‹äºè–„ç…é¥¼ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥å¯¹æ–¹æ³•è¿›è¡Œé“¾å¼è°ƒç”¨å¦‚ `clickStream.map(f).scan(g)`.

    clickStream: ---c----c--c----c------c-->
                   vvvvv map(c becomes 1) vvvv
                   ---1----1--1----1------1-->
                   vvvvvvvvv scan(+) vvvvvvvvv
    counterStream: ---1----2--3----4------5-->

ä¸ºäº†å±•ç¤ºRPçœŸæ­£çš„å®åŠ›ï¼Œè®©æˆ‘ä»¬å‡è®¾ä½ æƒ³å¾—åˆ°ä¸€ä¸ªåŒ…å«åŒå‡»äº‹ä»¶çš„Streamã€‚ä¸ºäº†è®©å®ƒæ›´åŠ æœ‰è¶£ï¼Œå‡è®¾æˆ‘ä»¬æƒ³è¦çš„è¿™ä¸ªStreamè¦åŒæ—¶è€ƒè™‘ä¸‰å‡» (Triple clicks)ï¼Œæˆ–è€…æ›´åŠ å®½æ³›ï¼Œè¿å‡» (Multiple clicks)ã€‚æˆ‘ä»¬å…ˆä¸è®¨è®ºå®ƒçš„å®ç°ï¼Œç”¨ç¤ºæ„å›¾æ¥è¡¨ç¤ºè¿™ä¸ª stream å®ƒåº”è¯¥é•¿æˆè¿™æ ·ï¼š

![](/assets/in-post/2020-01-13-Introduction-of-RxJS-Stream-Multiple-Click-Event-Example.png )

### 2.4 è§‚å¯Ÿè€…æ¨¡å¼

è§‚å¯Ÿè€…æ¨¡å¼åˆå«å‘å¸ƒè®¢é˜…æ¨¡å¼ï¼ˆPublish/Subscribeï¼‰ï¼Œå®ƒæ˜¯ä¸€ç§ä¸€å¯¹å¤šçš„å…³ç³»ï¼Œè®©å¤šä¸ªè§‚å¯Ÿè€…ï¼ˆObesverï¼‰åŒæ—¶ç›‘å¬ä¸€ä¸ªä¸»é¢˜ï¼ˆSubjectï¼‰ï¼Œè¿™ä¸ªä¸»é¢˜ä¹Ÿå°±æ˜¯**è¢«è§‚å¯Ÿè€…ï¼ˆObservableï¼‰**ï¼Œè¢«è§‚å¯Ÿè€…çš„çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶å°±ä¼šé€šçŸ¥æ‰€æœ‰çš„è§‚å¯Ÿè€…ï¼Œä½¿å¾—å®ƒä»¬èƒ½å¤Ÿæ¥æ”¶åˆ°æ›´æ–°çš„å†…å®¹ã€‚è§‚å¯Ÿè€…æ¨¡å¼ä¸»é¢˜å’Œè§‚å¯Ÿè€…æ˜¯åˆ†ç¦»çš„ï¼Œä¸æ˜¯ä¸»åŠ¨è§¦å‘è€Œæ˜¯è¢«åŠ¨ç›‘å¬ã€‚

ç½‘ä¸Šæœ‰ä¸ªä¾‹å­è§£é‡Šçš„ä¸é”™ï¼šè´­æˆ¿è€…ä¸€ç›´åœ¨å¯†åˆ‡çš„å…³æ³¨æˆ¿ä»·ï¼Œè€Œæˆ¿ä»·éšæ—¶é—´æ³¢åŠ¨ï¼Œè´­æˆ¿è€…å¯èƒ½ä¼šæ ¹æ®æ³¢åŠ¨çš„æˆ¿ä»·è€Œé‡‡å–ä¸€ç³»åˆ—çš„è¡ŒåŠ¨ï¼Œæ¯”å¦‚è´­å…¥æˆ–è€…ç»§ç»­è§‚æœ›ã€‚è´­æˆ¿è€…ä¸æˆ¿ä»·çš„è¿™æ ·ä¸€ç§å…³ç³»å…¶å®å°±æ„æˆäº†ä¸€ç§è§‚å¯Ÿè€…å…³ç³»ã€‚è¿™é‡Œï¼Œè´­æˆ¿è€…æ‹…ä»»è§‚å¯Ÿè€…çš„è§’è‰²ï¼Œæˆ¿ä»·æ˜¯è¢«è§‚å¯Ÿçš„è§’è‰²ï¼Œå½“æˆ¿ä»·ä¿¡æ¯å‘ç”Ÿå˜åŒ–ï¼Œåˆ™è‡ªåŠ¨æ¨é€ä¿¡æ¯ç»™è´­æˆ¿è€…ã€‚

å…ˆè®°å¾—è¿™ä¸ªä¾‹å­ï¼Œåé¢ä»‹ç» RxJS æ—¶æˆ‘ä»¬ä¼šç»§ç»­ç”¨åˆ°ã€‚

### 2.5 è¿­ä»£å™¨æ¨¡å¼

è¿­ä»£å™¨ï¼ˆIteratorï¼‰æ¨¡å¼åˆå«æ¸¸æ ‡ï¼ˆSursorï¼‰æ¨¡å¼ï¼Œè¿­ä»£å™¨å…·æœ‰ next æ–¹æ³•ï¼Œå¯ä»¥é¡ºåºè®¿é—®ä¸€ä¸ªèšåˆå¯¹è±¡ä¸­çš„å„ä¸ªå…ƒç´ ï¼Œè€Œä¸éœ€è¦æš´éœ²è¯¥å¯¹è±¡çš„å†…éƒ¨è¡¨ç°ã€‚è¿­ä»£å™¨æ¨¡å¼å¯ä»¥æŠŠè¿­ä»£çš„è¿‡ç¨‹ä»ä»ä¸šåŠ¡é€»è¾‘ä¸­åˆ†ç¦»å‡ºæ¥ï¼Œè¿­ä»£å™¨å°†ä½¿ç”¨è€…å’Œç›®æ ‡å¯¹è±¡éš”ç¦»å¼€æ¥ï¼Œå³ä½¿ä¸äº†è§£å¯¹è±¡çš„å†…éƒ¨æ„é€ ï¼Œä¹Ÿå¯ä»¥é€šè¿‡è¿­ä»£å™¨æä¾›çš„æ–¹æ³•é¡ºåºè®¿é—®å…¶æ¯ä¸ªå…ƒç´ ã€‚

ä¾‹å¦‚åœ¨ JavaScript ä¸­ï¼Œå¯ä»¥é€šè¿‡ iterator æ–¹æ³•æ¥è·å–ä¸€ä¸ªè¿­ä»£å¯¹è±¡ï¼Œç„¶åè°ƒç”¨è¿­ä»£å¯¹è±¡çš„ next æ–¹æ³•å»è¿­ä»£å¾—åˆ°ä¸€ä¸ªä¸ªçš„å…ƒç´ ï¼š

    var iterable = [1, 2];
    var iterator = iterable[Symbol.iterator]();
    iterator.next(); // => { value: "1", done: false}
    iterator.next(); // => { value: "2", done: false}
    iterator.next(); // => { value: undefined, done: true}

åœ¨äº†è§£äº†å¦‚ä¸Šæ¦‚å¿µä¹‹åï¼Œæˆ‘ä»¬å›è¿‡å¤´å†çœ‹çœ‹ RxJS è§£å†³äº†å“ªäº›æ ¸å¿ƒé—®é¢˜ï¼š

- åŒæ­¥å’Œå¼‚æ­¥çš„ç»Ÿä¸€å†™æ³•
- æ•°æ®å˜æ›´è¿‡ç¨‹çš„ç»„åˆæ‹†åˆ†
- æ•°æ®å’Œè§†å›¾çš„ç²¾ç¡®ç»‘å®š
- æ¡ä»¶å˜æ›´åï¼Œå¯¹åº”æ•°æ®è‡ªåŠ¨é‡æ–°è®¡ç®—

æ²¡æœ‰å…¨æ˜ç™½ä¹Ÿæ²¡å…³ç³»ï¼Œæ¥ä¸‹æ¥äº†è§£ RxJs çš„æ ¸å¿ƒæ¦‚å¿µä¹Ÿå°±å®¹æ˜“ä¸€äº›äº†ã€‚

# ä¸‰ã€RxJS æ ¸å¿ƒæ¦‚å¿µä¸å†…å®¹æ¦‚è§ˆ

ä¸ç®¡æ˜¯å®˜æ–¹æ–‡æ¡£çš„æ¦‚è§ˆï¼Œè¿˜æ˜¯ç½‘ä¸Šæœçš„å„ç§å…¥é—¨æ•™ç¨‹ï¼Œå…³äº RxJS çš„æ ¸å¿ƒæ¦‚å¿µå°±è¿™å‡ ä¸ªï¼Œä¹Ÿæ˜¯æ–‡æ¡£ä¸­æåˆ°çš„ï¼š

- **Observable (å¯è§‚å¯Ÿå¯¹è±¡):**Â è¡¨ç¤ºä¸€ä¸ªæ¦‚å¿µï¼Œè¿™ä¸ªæ¦‚å¿µæ˜¯ä¸€ä¸ªå¯è°ƒç”¨çš„æœªæ¥å€¼æˆ–äº‹ä»¶çš„é›†åˆã€‚
- **Observer (è§‚å¯Ÿè€…):**Â ä¸€ä¸ªå›è°ƒå‡½æ•°çš„é›†åˆï¼Œå®ƒçŸ¥é“å¦‚ä½•å»ç›‘å¬ç”± Observable æä¾›çš„å€¼ã€‚
- **Subscription (è®¢é˜…):**Â è¡¨ç¤º Observable çš„æ‰§è¡Œï¼Œä¸»è¦ç”¨äºå–æ¶ˆ Observable çš„æ‰§è¡Œã€‚
- **Operators (æ“ä½œç¬¦):**Â é‡‡ç”¨å‡½æ•°å¼ç¼–ç¨‹é£æ ¼çš„çº¯å‡½æ•° (pure function)ï¼Œä½¿ç”¨åƒÂ `map`ã€`filter`ã€`concat`ã€`flatMap`Â ç­‰è¿™æ ·çš„æ“ä½œç¬¦æ¥å¤„ç†é›†åˆã€‚
- **Subject (ä¸»ä½“):**Â ç›¸å½“äº EventEmitterï¼Œå¹¶ä¸”æ˜¯å°†å€¼æˆ–äº‹ä»¶å¤šè·¯æ¨é€ç»™å¤šä¸ª Observer çš„å”¯ä¸€æ–¹å¼ã€‚
- **Schedulers (è°ƒåº¦å™¨):**Â ç”¨æ¥æ§åˆ¶å¹¶å‘å¹¶ä¸”æ˜¯ä¸­å¤®é›†æƒçš„è°ƒåº¦å‘˜ï¼Œå…è®¸æˆ‘ä»¬åœ¨å‘ç”Ÿè®¡ç®—æ—¶è¿›è¡Œåè°ƒï¼Œä¾‹å¦‚Â `setTimeout`Â æˆ–Â `requestAnimationFrame`Â æˆ–å…¶ä»–ã€‚

ç½—åˆ—çŸ¥è¯†ç‚¹å¯¹ç†è§£å¦‚ä½•ä½¿ç”¨å¹¶ä¸ä¼šæœ‰å¤ªå¤§å¸®åŠ©ï¼Œæ‰€ä»¥æˆ‘ä¹Ÿç®€å•è¯´è¯´è‡ªå·±çš„ä½“ä¼šï¼Œä»¥ä¸‹çš„å†…å®¹ä¼šå¼€å§‹ç»“åˆ RxJS çš„ç›¸å…³å†…å®¹ã€‚

### 3.1 ç†è§£ RxJS ä¸­çš„ Observer ä¸ Observable

é¦–å…ˆï¼Œå¦‚ä½•ç†è§£ Observer å’Œ Observable å‘¢ï¼Ÿæˆ‘ä»¬å›åˆ°ä¹‹å‰çš„è´­æˆ¿è€…ä¾‹å­ã€‚å°†é‚£ä¸ªä¾‹å­å¥—ç”¨åˆ°è§‚å¯Ÿè€…æ¨¡å¼ä¸­ï¼š

- æˆ¿ä»·å³ä¸º Observable å¯¹è±¡ï¼›
- è´­æˆ¿è€…å³ä¸º Observer å¯¹è±¡ï¼›
- è€Œè´­æˆ¿è€…è§‚å¯Ÿæˆ¿ä»·å³ä¸º Subscribeï¼ˆè®¢é˜…ï¼‰å…³ç³»ï¼›

å†ç»“åˆä¹°æˆ¿çš„ä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå­¦æœ¯çš„æè¿° Observable å’Œ Observer çš„è¡Œä¸ºï¼š

- Observable ****å¯è¢«è§‚å¯Ÿï¼Œå³æˆ¿ä»·è¢«è´­æˆ¿è€…å…³æ³¨ï¼Œå¹¶ä¸”éšæ—¶é—´å˜åŒ–å‘å‡º (emit) ä¸åŒå€¼ï¼Œè¡¨ç°ä¸ºæˆ¿ä»·æ³¢åŠ¨ï¼›
- ObserverÂ å¯ä»¥è§‚å¯Ÿ Observableï¼Œå³è´­æˆ¿è€…å…³æ³¨æˆ¿ä»·ï¼Œå¹¶åœ¨ Observable ï¼ˆæˆ¿ä»·ï¼‰å‘å‡ºä¸åŒå€¼ï¼ˆæˆ¿ä»·æ³¢åŠ¨ï¼‰æ—¶åšå‡ºå“åº”ï¼Œå³ä¹°æˆ¿æˆ–è§‚æœ›ï¼›
- Observable å’Œ Observer ä¹‹é—´é€šè¿‡è®¢é˜…ï¼ˆSubscriptionï¼‰å»ºç«‹è§‚å¯Ÿå…³ç³»ï¼›
- å½“ Observable æ²¡æœ‰ Observer çš„æ—¶å€™ï¼Œå³ä½¿å‘å‡ºäº†å€¼ï¼Œä¹Ÿä¸ä¼šäº§ç”Ÿä»»ä½•å½±å“ï¼Œå³æ— äººå…³æ³¨æˆ¿ä»·æ—¶ï¼Œæˆ¿ä»·ä¸ç®¡å¦‚ä½•æ³¢åŠ¨éƒ½ä¸ä¼šæœ‰å“åº”ï¼›

### 3.2 Observer, Observable ä¸ Subscription ç¤ºä¾‹

Observable æ˜¯å¤šä¸ªå€¼çš„æƒ°æ€§æ¨é€é›†åˆã€‚å›åˆ° RxJS æˆ‘ä»¬ç”¨ä¸€ä¸ªä¾‹å­æ¥çœ‹çœ‹å¦‚ä½•æ„å»ºä¸€ä¸ª Observableï¼š

    import { Observable } from 'rxjs';
    
    const observable = Observable.create(observer => {
      observer.next('foo');
      observer.next('bar');
    })

æˆ‘ä»¬å¯ä»¥è°ƒç”¨ `Observable.create` æ–¹æ³•æ¥åˆ›å»ºä¸€ä¸ª Observableï¼Œè¿™ä¸ªæ–¹æ³•æ¥å—ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè¿™ä¸ªå‡½æ•°å«åš `producer` å‡½æ•°ï¼Œ ç”¨æ¥ç”Ÿæˆ Observable çš„å€¼ã€‚è¿™ä¸ªå‡½æ•°çš„å…¥å‚æ˜¯ observerï¼Œåœ¨å‡½æ•°å†…éƒ¨é€šè¿‡è°ƒç”¨ `observer.next()` ä¾¿å¯ç”Ÿæˆæœ‰ä¸€ç³»åˆ—å€¼çš„ä¸€ä¸ª Observableã€‚å½“ä¸€ä¸ª Observable è¢«å»ºç«‹åï¼Œå®ƒèƒ½è¢«å¤šä¸ª observer è®¢é˜…ï¼Œæ¯ä¸ªè®¢é˜…å…³ç³»ç›¸äº’ç‹¬ç«‹ã€äº’ä¸å½±å“ã€‚

ä½†æ˜¯è¿è¡Œè¿™æ®µä»£ç åå¹¶ä¸ä¼šå‘ç”Ÿä»»ä½•äº‹æƒ…ï¼Œå¦‚ä¸Šæ‰€è¿°ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ª observer å»è®¢é˜…è¿™ä¸ª observableï¼Œæ­¤ååŸºäº observable å‘å‡ºçš„å€¼ï¼Œobserver æ‰ä¼šå“åº”ã€‚å› æ­¤ï¼Œåœ¨å¦‚ä¸Šä»£ç æœ«å°¾ï¼Œæˆ‘ä»¬å†åŠ ä¸Šä¸€è¡Œï¼š

    observable.subscribe(console.log);

 è¿è¡Œä»£ç ï¼Œconsole.log å‡½æ•°ä¾¿ä¼šä¾æ¬¡æ‰“å°å‡º 'foo' å’Œ 'bar' äº†ã€‚

Subscription æ˜¯è¡¨ç¤ºå¯æ¸…ç†èµ„æºçš„å¯¹è±¡ï¼Œé€šå¸¸æ˜¯ Observable çš„æ‰§è¡Œã€‚Subscription æœ‰ä¸€ä¸ªé‡è¦çš„æ–¹æ³•ï¼Œå³ unsubscribeï¼Œå®ƒä¸éœ€è¦ä»»ä½•å‚æ•°ï¼Œåªæ˜¯ç”¨æ¥æ¸…ç†ç”± Subscription å ç”¨çš„èµ„æºã€‚ä¾æ—§æ˜¯å®˜æ–¹çš„ä¸€ä¸ªç¤ºä¾‹ï¼ŒæŠŠå…¶ä½œç”¨è¡¨è¿°çš„å·²ç»å¾ˆæ˜ç¡®äº†ï¼š

    var observable = Rx.Observable.interval(1000);
    var subscription = observable.subscribe(x => console.log(x));
    // ç¨åï¼š
    // è¿™ä¼šå–æ¶ˆæ­£åœ¨è¿›è¡Œä¸­çš„ Observable æ‰§è¡Œ
    // Observable æ‰§è¡Œæ˜¯é€šè¿‡ä½¿ç”¨è§‚å¯Ÿè€…è°ƒç”¨ subscribe æ–¹æ³•å¯åŠ¨çš„
    subscription.unsubscribe();

### 3.3 Subject

ä»€ä¹ˆæ˜¯ Subjectï¼ŸRxJS ä¸­ Subject æ˜¯ä¸€ç§ç‰¹æ®Šç±»å‹çš„ Observableï¼Œå®ƒå…è®¸å°†å€¼å¤šæ’­ç»™å¤šä¸ªè§‚å¯Ÿè€…ï¼Œæ‰€ä»¥ Subject æ˜¯å¤šæ’­çš„ï¼Œè€Œæ™®é€šçš„ Observables æ˜¯å•æ’­çš„(æ¯ä¸ªå·²è®¢é˜…çš„è§‚å¯Ÿè€…éƒ½æ‹¥æœ‰ Observable çš„ç‹¬ç«‹æ‰§è¡Œ)ã€‚ä¸ç†è§£ã€Œå•æ’­ã€è¿™ä¸ªè¯å¯ä»¥å…ˆè·³è¿‡ï¼Œæ˜ç™½ subject æ˜¯ä¸€ç§ observable å³å¯ã€‚

å¯¹äº Subjectï¼Œä½ å¯ä»¥æä¾›ä¸€ä¸ªè§‚å¯Ÿè€…å¹¶ä½¿ç”¨ subscribe æ–¹æ³•ï¼Œå°±å¯ä»¥å¼€å§‹æ­£å¸¸æ¥æ”¶å€¼ã€‚ä»è§‚å¯Ÿè€…çš„è§’åº¦è€Œè¨€ï¼Œå®ƒæ— æ³•åˆ¤æ–­ Observable æ‰§è¡Œæ˜¯æ¥è‡ªæ™®é€šçš„ Observable è¿˜æ˜¯ Subject ã€‚åœ¨è¿™é‡Œï¼Œsubscribe ç±»ä¼¼äº JavaScript ä¸­çš„ addEventListenerï¼›ä¸æ­¤åŒæ—¶ï¼Œæ¯ä¸ª Subject åˆéƒ½æ˜¯è§‚å¯Ÿè€…ã€‚Subject æ˜¯ä¸€ä¸ªæœ‰å¦‚ä¸‹æ–¹æ³•çš„å¯¹è±¡ï¼š `next(v)`ã€ `error(e)` å’Œ `complete()` ã€‚è¦ç»™ Subject æä¾›æ–°å€¼ï¼Œåªè¦è°ƒç”¨ `next(theValue)` æ–¹æ³•ã€‚

    var subject = new Rx.Subject();
    
    subject.subscribe({
      next: (v) => console.log('observerA: ' + v)
    });
    subject.subscribe({
      next: (v) => console.log('observerB: ' + v)
    });
    
    subject.next(1);
    subject.next(2);

å¦‚ä¸Šä»£ç çš„æ§åˆ¶å°è¾“å‡ºä¸ºï¼š

    observerA: 1
    observerB: 1
    observerA: 2
    observerB: 2

### 3.4 Operators

æ“ä½œç¬¦æ˜¯å‡½æ•°ï¼Œå®ƒåŸºäºå½“å‰çš„ Observable åˆ›å»ºä¸€ä¸ªæ–°çš„ Observableã€‚è¿™æ˜¯ä¸€ä¸ªæ— å‰¯ä½œç”¨çš„æ“ä½œï¼šå‰é¢çš„ Observable ä¿æŒä¸å˜ã€‚

æ“ä½œç¬¦æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªçº¯å‡½æ•° (pure function)ï¼Œå®ƒæ¥æ”¶ä¸€ä¸ª Observable ä½œä¸ºè¾“å…¥ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªæ–°çš„ Observable ä½œä¸ºè¾“å‡ºã€‚è®¢é˜…è¾“å‡º Observable åŒæ ·ä¼šè®¢é˜…è¾“å…¥ Observable ã€‚æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼Œè¿™é‡Œä¼šç”¨åˆ°ä¸¤ä¸ªæ“ä½œç¬¦ï¼Œåˆ†åˆ«æ˜¯[åˆ›å»ºæ“ä½œç¬¦](https://cn.rx.js.org/manual/overview.html#creation-operators) interval ä»¥åŠè½¬æ¢æ“ä½œç¬¦ mapï¼š

    import { Observable, interval } from 'rxjs';
    import { map } from 'rxjs/operators';
    
    const observable = interval(1000).pipe(map(value => value * 10));
    
    const subscription = observable.subscribe(console.log);

å…³äºè¿™ä¸¤ä¸ªæ“ä½œç¬¦çš„ä½œç”¨è¿™é‡Œç®€å•è§£é‡Šä¸€ä¸‹ï¼š `interval` çš„ä½œç”¨æ˜¯åˆ›å»ºä¸€ä¸ª Observable ï¼Œè¯¥ Observable ä½¿ç”¨æŒ‡å®šçš„ IScheduler å¹¶ä»¥æŒ‡å®šæ—¶é—´é—´éš”å‘å‡ºè¿ç»­çš„æ•°å­—ï¼Œè€Œå `map` çš„ä½œç”¨å­—å¦‚å…¶åï¼Œå³å°†ç»™å®šçš„å‡½æ•°åº”ç”¨äºæº Observable å‘å‡ºçš„æ¯ä¸ªå€¼ï¼Œå¹¶å°†ç»“æœå€¼ä½œä¸º Observable å‘å‡ºã€‚

ç”±äº RxJS æ¶‰åŠåˆ°çš„æ¦‚å¿µå’ŒçŸ¥è¯†ç‚¹æ¯”è¾ƒå®½æ³›å’Œå¤æ‚ï¼Œå…³äºæ“ä½œç¬¦çš„ä»‹ç»è¿™é‡Œå°±ä¸ä¸€ä¸€åˆ—ä¸¾äº†ã€‚ä½†åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œå®çŸ³å›¾ï¼ˆä¹Ÿæœ‰ç§°å¼¹ç å›¾ï¼ŒåŸæ–‡ä¸º marble diagramï¼‰æ˜¯ä¸ªéå¸¸æœ‰ç”¨çš„å·¥å…·ï¼Œèƒ½å¤Ÿå¸®åŠ©ä½ å¿«é€Ÿäº†è§£å¯¹åº”æ“ä½œç¬¦çš„ä½œç”¨ï¼Œåœ°å€è§ [https://rxmarbles.com/](https://rxmarbles.com/)ã€‚åœ¨å®˜ç½‘æ–‡æ¡£ä¸­ï¼Œ å¤§å¤šæ•°æ“ä½œç¬¦éƒ½ä¼šé™„æœ‰å®çŸ³å›¾ã€‚ åªè¦ä¼šçœ‹å®çŸ³å›¾ï¼Œå­¦èµ·æ“ä½œç¬¦æ¥ä¼šéå¸¸çš„å¿«ã€‚æ¯”å¦‚ `map` çš„å®çŸ³å›¾ä¾¿å¦‚ä¸‹ï¼š

![](/assets/in-post/2020-01-13-Introduction-of-RxJS-Stream-Map-Operator-Example.png )

RxJS 6 åŠæ›´æ–°ç‰ˆæœ¬æä¾›äº†å¯é“¾å¼è°ƒç”¨ï¼ˆPipeableï¼‰çš„ RxJS æ“ä½œç¬¦ï¼Œå‡è®¾ source æ˜¯ä¸€ä¸ªå·²å®šä¹‰çš„ observableï¼Œä¸€ä¸ªç®€å•ç¤ºä¾‹å¦‚ä¸‹ï¼š

    source.pipe(
      map(x => x + x),
      mergeMap(n => of(n + 1, n + 2).pipe(
        filter(x => x % 1 == 0),
        scan((acc, x) => acc + x, 0),
      )),
      catchError(err => of('error found')),
    ).subscribe(console.log);

### 3.5 Schedulers

ä»€ä¹ˆæ˜¯è°ƒåº¦å™¨ï¼Ÿè°ƒåº¦å™¨æ§åˆ¶ç€ä½•æ—¶å¯åŠ¨ subscription å’Œä½•æ—¶å‘é€é€šçŸ¥ã€‚ä½¿ç”¨ `subscribeOn` æ¥è°ƒåº¦ `subscribe()` è°ƒç”¨åœ¨ä»€ä¹ˆæ ·çš„ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼ŒObservable çš„ `subscribe()` è°ƒç”¨ä¼šç«‹å³åŒæ­¥åœ°æ‰§è¡Œã€‚ç„¶è€Œï¼Œä½ å¯èƒ½ä¼šå»¶è¿Ÿæˆ–å®‰æ’åœ¨ç»™å®šçš„è°ƒåº¦å™¨ä¸Šæ‰§è¡Œå®é™…çš„ subscription ï¼Œä½¿ç”¨å®ä¾‹æ“ä½œç¬¦ `subscribeOn(scheduler)`ï¼Œå…¶ä¸­ scheduler æ˜¯ä½ æä¾›çš„å‚æ•°ã€‚æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªåŒæ­¥å˜å¼‚æ­¥æ‰§è¡Œçš„ä¾‹å­ï¼š

    var observable = Rx.Observable.create(function (observer) {
      observer.next(1);
      observer.next(2);
      observer.next(3);
      observer.complete();
    })
    .observeOn(Rx.Scheduler.async);
    
    console.log('just before subscribe');
    observable.subscribe({
      next: x => console.log('got value ' + x),
      error: err => console.error('something wrong occurred: ' + err),
      complete: () => console.log('done'),
    });
    console.log('just after subscribe');

è¿™æ®µä»£ç çš„è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š

    just before subscribe
    just after subscribe
    got value 1
    got value 2
    got value 3
    done

è°ƒåº¦å™¨ç±»å‹ä¸€å…±æœ‰å››ç§ï¼Œè¯¦è§æ–‡æ¡£ [https://cn.rx.js.org/manual/overview.html#h214](https://cn.rx.js.org/manual/overview.html#h214)ã€‚

# å››ã€è‹¥å¹²ç¤ºä¾‹

### 4.1 å°†æ•°ç»„è½¬åŒ–ä¸º Observable

    import { from } from 'rxjs';
    
    const array = [10, 20, 30];
    const result = from(array);
    
    result.subscribe(x => console.log(x));

### 4.2 å•æ’­ä¸å¤šæ’­

å•æ’­ç¤ºä¾‹

    let observable = Rx.Observable.create(function subscribe(obsever) {
      observer.next(1)
      observer.next(2)
    })
    observable.subscribe(v => console.log(v))
    observable.subscribe(v => console.log(v))
    
    // è¾“å‡ºä¸¤ä»½ 1, 2

å¤šæ’­ç¤ºä¾‹

    let observable = Rx.Observable.create(function subscribe(obsever) {
      observer.next(1)
      observer.next(2)
    })
    let subject = new Rx.Subject()
    subject.subscribe(v => console.log(v))
    subject.subscribe(v => console.log(v))
    observable.subscribe(subject)
    
    // è¾“å‡º 1, 1; 2, 2;

### 4.3 Hot Observable ä¸ Cold Observable

> Hot Observable æ— è®ºæœ‰æ²¡æœ‰ Subscriber è®¢é˜…ï¼Œäº‹ä»¶å§‹ç»ˆéƒ½ä¼šå‘ç”Ÿã€‚å½“ Hot Observable æœ‰å¤šä¸ªè®¢é˜…è€…æ—¶ï¼ŒHot Observable ä¸è®¢é˜…è€…ä»¬çš„å…³ç³»æ˜¯ä¸€å¯¹å¤šçš„å…³ç³»ï¼Œå¯ä»¥ä¸å¤šä¸ªè®¢é˜…è€…å…±äº«ä¿¡æ¯ã€‚

> ç„¶è€Œï¼ŒCold Observable åªæœ‰ Subscriber è®¢é˜…æ—¶ï¼Œæ‰å¼€å§‹æ‰§è¡Œå‘å°„æ•°æ®æµçš„ä»£ç ã€‚å¹¶ä¸” Cold Observable å’Œ Subscriber åªèƒ½æ˜¯ä¸€å¯¹ä¸€çš„å…³ç³»ï¼Œå½“æœ‰å¤šä¸ªä¸åŒçš„è®¢é˜…è€…æ—¶ï¼Œæ¶ˆæ¯æ˜¯é‡æ–°å®Œæ•´å‘é€çš„ã€‚ä¹Ÿå°±æ˜¯è¯´å¯¹ Cold Observable è€Œè¨€ï¼Œæœ‰å¤šä¸ªSubscriberçš„æ—¶å€™ï¼Œä»–ä»¬å„è‡ªçš„äº‹ä»¶æ˜¯ç‹¬ç«‹çš„ã€‚â€”â€” [Cold Observable å’Œ Hot Observable](https://www.jianshu.com/p/12fb42bcf9fd)

Cold observable ç¤ºä¾‹ä¸æ‰“å°ç»“æœ

    const obs$ = Rx.Observable
      .from(['ğŸ•', 'ğŸª', 'ğŸ”', 'ğŸŒ­', 'ğŸŸ'])
      .map(val => {
        return `Miam ${val}!`;
      });
    
    const sub1 = obs$.subscribe(val => {
      console.log('From sub1:', val);
    }, null, () => {
      console.log('done ----------------');
    });
    
    const sub2 = obs$.subscribe(val => {
      console.log('From sub2:', val);
    }, null, () => {
      console.log('done ----------------');
    });
    
    // è¾“å‡ºç»“æœ
    From sub1: Miam ğŸ•!
    From sub1: Miam ğŸª!
    From sub1: Miam ğŸ”!
    From sub1: Miam ğŸŒ­!
    From sub1: Miam ğŸŸ!
    done ----------------
    From sub2: Miam ğŸ•!
    From sub2: Miam ğŸª!
    From sub2: Miam ğŸ”!
    From sub2: Miam ğŸŒ­!
    From sub2: Miam ğŸŸ!
    done ----------------

Hot Observable ç¤ºä¾‹

    const obs$ = Rx.Observable.fromEvent(document, 'click')
      .map(event => ({ clientX: event.clientX, clientY: event.clientY }));
    
    const sub1 = obs$.subscribe(val => {
      console.log('Sub1:', val);
    });
    
    setTimeout(() => {
      console.log('Start sub2');
      const sub2 = obs$.subscribe(val => {
        console.log('Sub2:', val);
      });
    }, 4000);

å…³äº Hot Observable ç¤ºä¾‹çš„è¾“å‡ºï¼Œè¿™é‡Œè§£é‡Šä¸€ä¸‹ã€‚ä¸¤ä¸ªè®¢é˜…è€…å…±äº«åŒä¸€ streamï¼Œä½†æ˜¯ç¬¬äºŒä¸ªè®¢é˜…åªä¼šåœ¨4ç§’åæ‰ä¼šå“åº”è¾“å‡ºã€‚

æ³¨

1. JavaScript åŒæ­¥/å¼‚æ­¥ç¤ºæ„å›¾å–è‡ª [https://www.bbsmax.com/A/1O5Ev9xad7/](https://www.bbsmax.com/A/1O5Ev9xad7/)
2. Stream ç¤ºæ„å›¾å–è‡ª [https://github.com/benjycui/introrx-chinese-edition/blob/master/introrx.md](https://github.com/benjycui/introrx-chinese-edition/blob/master/introrx.md)

å‚è€ƒ

- [https://cn.rx.js.org/](https://cn.rx.js.org/manual/overview.html)
- [https://github.com/xufei/blog/issues/44](https://github.com/xufei/blog/issues/44)
- [https://www.jianshu.com/p/035db36c5918](https://www.jianshu.com/p/035db36c5918)
- [https://zhuanlan.zhihu.com/p/27678951](https://zhuanlan.zhihu.com/p/27678951)
- [https://hateonion.me/posts/19jul16/](https://hateonion.me/posts/19jul16/)
- [https://rxmarbles.com/](https://rxmarbles.com/#interval)

ï¼ˆå®Œï¼‰